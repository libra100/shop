<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    </head>
    <body>
        <h3>分類</h3>
        <select id="sort">
            <option disabled selected>請選擇</option>
        </select>
        <h3>貨號</h3>
        <input type="text" id="number">
        <h3>品名</h3>
        <input type="text" id="name">
        <h3>價錢</h3>
        <input type="number" id="price">
        <br><br>
        <input type="file" id="fileButton" value="upload">
        <br><br>
        <button onclick="add()">新增</button>
    </body>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
        firebase.initializeApp({
            apiKey: "AIzaSyCfo1lZapLv7Mzalkz624DXydtTXGJelOA",
            authDomain: "wanxin.firebaseapp.com",
            storageBucket: 'wanxin.appspot.com',
            projectId: "wanxin",
        });
        const db = firebase.firestore();
        const storage = firebase.storage();

        db.collection("公司").doc("分類").get().then((doc)=>{
            var sort = document.getElementById("sort");
            var count = doc.data().count;
            
            for(i=0;i<count;i++){
                var option = document.createElement("option");
                switch(i){
                    case 0:
                        option.appendChild(document.createTextNode(doc.data().first));
                        break;
                    case 1:
                        option.appendChild(document.createTextNode(doc.data().second));
                        break;
                    case 2:
                        option.appendChild(document.createTextNode(doc.data().third));
                        break;
                    case 3:
                        option.appendChild(document.createTextNode(doc.data().forth));
                        break;
                    case 4:
                        option.appendChild(document.createTextNode(doc.data().fifth));
                        break;
                    case 5:
                        option.appendChild(document.createTextNode(doc.data().sixth));
                        break;
                    case 6:
                        option.appendChild(document.createTextNode(doc.data().seventh));
                        break;
                    case 7:
                        option.appendChild(document.createTextNode(doc.data().eighth));
                        break;
                    case 8:
                        option.appendChild(document.createTextNode(doc.data().nineth));
                        break;
                    case 9:
                        option.appendChild(document.createTextNode(doc.data().tenth));
                        break;
                    case 10:
                        option.appendChild(document.createTextNode(doc.data().eleventh));
                        break;
                    case 11:
                        option.appendChild(document.createTextNode(doc.data().twelveth));
                        break;
                }
                sort.appendChild(option);
            }
            
        }).catch((e)=>{
            // console.log(e);
        })
        
        function add(){
            var sort = document.getElementById("sort").value;
            var number = document.getElementById("number").value;
            var name = document.getElementById("name").value;
            var price = document.getElementById("price").value

            if(sort == "請選擇")
                alert("請選擇類別");
            else{
                db.collection(sort).doc(number).set({
                    name: name,
                    price: "$"+price
                }, {merge: true});

                var file = document.getElementById('fileButton').files[0];
                    storage.ref(sort+'/'+number).put(file);

                alert("新增成功");
            }
        }
    </script>
</html>